---
alwaysApply: true
---

# プロジェクト仕様

## 概要
AI求人マッチングアプリケーション

## プロジェクトの目的
- 求職者と求人のマッチング
- AIを活用したレコメンド機能（将来的に）

## 技術スタック
- Laravel 12.x
- Livewire 3 + Volt (Functional)
- Flux UI Free
- Tailwind CSS v4
- Pest v4

## 認証システム
- Laravel Fortifyベースの認証（Livewire Starter Kit）
- 2要素認証対応
- セッション管理

## ルーティング規約
- リソースルート: 複数形（例: `/jobs`, `/applications`）
- 機能別ルート: 適切な命名（例: `/dashboard`, `/settings`）
- 認証必須ルート: `auth`ミドルウェア使用
- 名前付きルート必須

## ロール機能

### ユーザーロール
- `company`: 企業ユーザー（求人投稿、応募管理）
- `worker`: ワーカーユーザー（求人応募、応募一覧）

### ロールベースミドルウェア
- ミドルウェア名: `role`
- 実装クラス: `App\Http\Middleware\EnsureUserHasRole`
- 使用方法: `->middleware('role:company')` または `->middleware('role:worker')`
- 不正アクセス時: 403エラー（Access Denied）

### ログイン後のリダイレクト
- すべてのユーザー: `/dashboard` にリダイレクト
- プロフィール登録の有無に関わらず共通

## UI設計ルール

### 未実装機能へのリンク表示
段階的な実装を進める際（詳細画面→編集画面→登録画面の順）、未実装機能へのリンクには以下のルールを適用：

- 未実装機能へのリンクには「（準備中）」の文言を追加
- リンクは無効化する（`disabled` 属性を使用）
- 実装完了後、「（準備中）」を削除し、正しいリンクを設定

**実装例**:
```blade
<!-- 未実装時 -->
<flux:button disabled>
    編集（準備中）
</flux:button>

<!-- 実装後 -->
<flux:button :href="route('jobs.edit', $job)" wire:navigate>
    編集
</flux:button>
```

**実装手順**:
1. 詳細画面作成時：編集・削除ボタンを「（準備中）」で実装
2. 編集画面作成時：編集ボタンを有効化、「（準備中）」を削除
3. 登録画面作成時：新規作成ボタンを有効化、「（準備中）」を削除

## ポリシーと認可
- 各モデルに対応するPolicyクラス作成
- アクション実行前の認可チェック必須
- `$this->authorize()`メソッド使用

## バリデーション
- Form Requestクラス使用必須
- インラインバリデーション禁止
- 日本語エラーメッセージ
- カスタムバリデーションルールは適切に分離

---

## 実装済み機能

### 認証・アカウント管理

#### ログイン
- **ルート**: `GET/POST /login`
- **コンポーネント**: Fortify標準
- **機能**: メールアドレスとパスワードでログイン

#### ユーザー登録
- **ルート**: `GET/POST /register`
- **コンポーネント**: Fortify標準
- **機能**: 新規アカウント作成

#### パスワードリセット
- **ルート**: `GET/POST /password/reset`
- **コンポーネント**: Fortify標準
- **機能**: メール経由でのパスワードリセット

#### 2要素認証
- **ルート**: `/settings/two-factor`
- **コンポーネント**: `resources/views/livewire/settings/two-factor.blade.php`
- **機能**: 2FAの有効化・無効化、リカバリーコード管理

### 企業プロフィール管理

#### 企業登録画面
- **ルート**: `GET /company/register`、`POST /company/register`
- **ルート名**: `company.register`
- **コンポーネント**: `resources/views/livewire/company/register.blade.php`
- **ミドルウェア**: なし（未認証ユーザー向け）
- **機能**: ユーザー登録と企業プロフィールを同時登録
- **入力項目**:
  - name: 企業名（必須）
  - email: メールアドレス（必須、ユニーク）
  - password: パスワード（必須、8文字以上）
  - password_confirmation: パスワード確認（必須）
  - location_id: 所在地（必須、2段階選択：都道府県→市区町村）
  - address: 所在地住所（必須、200文字以内）
  - representative: 担当者名（必須、50文字以内）
  - phone_number: 担当者連絡先（必須、30文字以内）
- **処理**:
  - usersテーブルにユーザー登録（role='company'、name=企業名）
  - company_profilesテーブルにプロフィール登録
  - 登録成功後、企業詳細画面（company.profile）にリダイレクト
- **UI**:
  - ユーザー情報と企業プロフィール情報を1画面で入力
  - 2段階選択（都道府県→市区町村）の実装

#### 企業詳細画面
- **ルート**: `GET /company/profile`
- **ルート名**: `company.profile`
- **コンポーネント**: `resources/views/livewire/company/show.blade.php`
- **ミドルウェア**: `auth`, `role:company`
- **機能**: ログインユーザーの企業プロフィール表示
- **表示項目**:
  - 企業名（users.name）
  - 所在地（都道府県 市区町村、例：東京都 千代田区）
  - 所在地住所
  - 担当者名
  - 担当者連絡先
  - 登録日時
  - 更新日時
- **アクション**: 編集画面へのリンク

#### 企業編集画面
- **ルート**: `GET /company/edit`
- **ルート名**: `company.edit`
- **コンポーネント**: `resources/views/livewire/company/edit.blade.php`
- **ミドルウェア**: `auth`, `role:company`
- **機能**: ログインユーザーの企業プロフィール編集
- **入力項目**: 企業プロフィール項目のみ（location_id, address, representative, phone_number）
- **処理**:
  - バリデーション後、company_profilesテーブルを更新
  - 更新成功後、企業詳細画面（company.profile）にリダイレクト
- **UI**:
  - 既存データを初期表示
  - 2段階選択（都道府県→市区町村）の実装
- **注意**: 企業名（users.name）の変更は別途ユーザー情報編集機能で対応

#### 所在地の2段階選択仕様
- **都道府県選択**:
  - locationsテーブルから`city IS NULL`のデータを取得
  - `code`の昇順でソート
- **市区町村選択**:
  - 選択された都道府県に対応する市区町村を取得
  - `prefecture`が選択された都道府県と一致し、`city IS NOT NULL`のデータ
  - `code`の昇順でソート
- **連動動作**:
  - 都道府県を変更すると、市区町村の選択肢が更新される
  - 都道府県を変更すると、市区町村の選択はリセットされる

### ワーカープロフィール管理

#### ワーカー登録画面
- **ルート**: `GET /worker/register`、`POST /worker/register`
- **ルート名**: `worker.register`
- **コンポーネント**: `resources/views/livewire/worker/register.blade.php`
- **ミドルウェア**: なし（未認証ユーザー向け）
- **機能**: ユーザー登録とワーカープロフィールを同時登録
- **入力項目**:
  - name: 氏名（必須）
  - email: メールアドレス（必須、ユニーク）
  - password: パスワード（必須、8文字以上）
  - password_confirmation: パスワード確認（必須）
  - gender: 性別（必須、ラジオボタン：male, female, other）
  - birthdate: 生年月日（必須、年月日ドロップダウン）
  - skills: スキル（任意、200文字以内、テキストエリア）
  - experiences: 経験（任意、200文字以内、テキストエリア）
  - desired_jobs: 希望職種（任意、200文字以内）
  - desired_location_id: 希望勤務地（任意、2段階選択：都道府県→市区町村）
- **処理**:
  - usersテーブルにユーザー登録（role='worker'、name=氏名）
  - worker_profilesテーブルにプロフィール登録
  - 登録成功後、ワーカー詳細画面（worker.profile）にリダイレクト
- **UI**:
  - ユーザー情報とワーカープロフィール情報を1画面で入力
  - 年月日ドロップダウンの動的生成
  - 2段階選択（都道府県→市区町村、任意）の実装

#### ワーカー詳細画面
- **ルート**: `GET /worker/profile`
- **ルート名**: `worker.profile`
- **コンポーネント**: `resources/views/livewire/worker/show.blade.php`
- **ミドルウェア**: `auth`, `role:worker`
- **機能**: ログインユーザーのワーカープロフィール表示
- **表示項目**:
  - 氏名（users.name）
  - 性別（日本語表示：male=男性、female=女性、other=その他）
  - 生年月日と年齢（例：1990年5月15日（34歳））
  - スキル（改行表示対応、NULL時は「未設定」）
  - 経験（改行表示対応、NULL時は「未設定」）
  - 希望職種（NULL時は「未設定」）
  - 希望勤務地（都道府県 市区町村、NULL時は「未設定」）
  - 登録日時
  - 更新日時
- **アクション**: 編集画面へのリンク

#### ワーカー編集画面
- **ルート**: `GET /worker/edit`
- **ルート名**: `worker.edit`
- **コンポーネント**: `resources/views/livewire/worker/edit.blade.php`
- **ミドルウェア**: `auth`, `role:worker`
- **機能**: プロフィール編集
- **入力項目**: ワーカープロフィール項目のみ（gender, birthdate, skills, experiences, desired_jobs, desired_location_id）
- **処理**:
  - バリデーション後、worker_profilesテーブルを更新
  - 更新成功後、ワーカー詳細画面（worker.profile）にリダイレクト
- **注意**: 氏名（users.name）の変更は別途ユーザー情報編集機能で対応

#### 生年月日の年月日選択仕様
- **年選択**: 現在年 - 18歳 から 現在年 - 80歳 まで（降順）
- **月選択**: 1月〜12月
- **日選択**: 選択された年月に応じて動的に生成
  - 1, 3, 5, 7, 8, 10, 12月: 1〜31日
  - 4, 6, 9, 11月: 1〜30日
  - 2月: 閏年判定（28日または29日）
- **連動動作**:
  - 年または月を変更すると、日の選択肢が更新される
  - 選択中の日が新しい日数を超える場合、日選択はリセット

#### 希望勤務地の2段階選択仕様（任意）
- **都道府県選択**:
  - locationsテーブルから`city IS NULL`のデータを取得
  - `code`の昇順でソート
  - 「選択しない」オプションあり
- **市区町村選択**:
  - 選択された都道府県に対応する市区町村を取得
  - `prefecture`が選択された都道府県と一致し、`city IS NOT NULL`のデータ
  - `code`の昇順でソート
  - 「選択しない」オプションあり
- **連動動作**:
  - 都道府県を変更すると、市区町村の選択肢が更新される
  - 都道府県を変更すると、市区町村の選択はリセットされる
  - 都道府県を「選択しない」にすると、市区町村も「選択しない」になる
