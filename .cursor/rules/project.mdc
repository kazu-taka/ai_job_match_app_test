---
alwaysApply: true
---

# プロジェクト仕様

## 概要
AI求人マッチングアプリケーション

## プロジェクトの目的
- 求職者と求人のマッチング
- AIを活用したレコメンド機能（将来的に）

## 技術スタック
- Laravel 12.x
- Livewire 3 + Volt (Functional)
- Flux UI Free
- Tailwind CSS v4
- Pest v4

## 認証システム
- Laravel Fortifyベースの認証（Livewire Starter Kit）
- 2要素認証対応
- セッション管理

## ルーティング規約
- リソースルート: 複数形（例: `/jobs`, `/applications`）
- 機能別ルート: 適切な命名（例: `/dashboard`, `/settings`）
- 認証必須ルート: `auth`ミドルウェア使用
- 名前付きルート必須

## ロール機能

### ユーザーロール
- `company`: 企業ユーザー（求人投稿、応募管理）
- `worker`: ワーカーユーザー（求人応募、応募一覧）

### ロールベースミドルウェア
- ミドルウェア名: `role`
- 実装クラス: `App\Http\Middleware\EnsureUserHasRole`
- 使用方法: `->middleware('role:company')` または `->middleware('role:worker')`
- 不正アクセス時: 403エラー（Access Denied）

### ログイン後のリダイレクト
- すべてのユーザー: `/dashboard` にリダイレクト
- プロフィール登録の有無に関わらず共通

## UI設計ルール

### 未実装機能へのリンク表示
段階的な実装を進める際（詳細画面→編集画面→登録画面の順）、未実装機能へのリンクには以下のルールを適用：

- 未実装機能へのリンクには「（準備中）」の文言を追加
- リンクは無効化する（`disabled` 属性を使用）
- 実装完了後、「（準備中）」を削除し、正しいリンクを設定

**実装例**:
```blade
<!-- 未実装時 -->
<flux:button disabled>
    編集（準備中）
</flux:button>

<!-- 実装後 -->
<flux:button :href="route('jobs.edit', $job)" wire:navigate>
    編集
</flux:button>
```

**実装手順**:
1. 詳細画面作成時：編集・削除ボタンを「（準備中）」で実装
2. 編集画面作成時：編集ボタンを有効化、「（準備中）」を削除
3. 登録画面作成時：新規作成ボタンを有効化、「（準備中）」を削除

## ポリシーと認可
- 各モデルに対応するPolicyクラス作成
- アクション実行前の認可チェック必須
- `$this->authorize()`メソッド使用

## バリデーション
- Form Requestクラス使用必須
- インラインバリデーション禁止
- 日本語エラーメッセージ
- カスタムバリデーションルールは適切に分離

---

## 実装済み機能

### 認証・アカウント管理

#### ログイン
- **ルート**: `GET/POST /login`
- **コンポーネント**: Fortify標準
- **機能**: メールアドレスとパスワードでログイン

#### ユーザー登録
- **ルート**: `GET/POST /register`
- **コンポーネント**: Fortify標準
- **機能**: 新規アカウント作成

#### パスワードリセット
- **ルート**: `GET/POST /password/reset`
- **コンポーネント**: Fortify標準
- **機能**: メール経由でのパスワードリセット

#### 2要素認証
- **ルート**: `/settings/two-factor`
- **コンポーネント**: `resources/views/livewire/settings/two-factor.blade.php`
- **機能**: 2FAの有効化・無効化、リカバリーコード管理

### 企業プロフィール管理

#### 企業登録画面
- **ルート**: `GET /company/register`、`POST /company/register`
- **ルート名**: `company.register`
- **コンポーネント**: `resources/views/livewire/company/register.blade.php`
- **ミドルウェア**: なし（未認証ユーザー向け）
- **機能**: ユーザー登録と企業プロフィールを同時登録
- **入力項目**:
  - name: 企業名（必須）
  - email: メールアドレス（必須、ユニーク）
  - password: パスワード（必須、8文字以上）
  - password_confirmation: パスワード確認（必須）
  - location_id: 所在地（必須、2段階選択：都道府県→市区町村）
  - address: 所在地住所（必須、200文字以内）
  - representative: 担当者名（必須、50文字以内）
  - phone_number: 担当者連絡先（必須、30文字以内）
- **処理**:
  - usersテーブルにユーザー登録（role='company'、name=企業名）
  - company_profilesテーブルにプロフィール登録
  - 登録成功後、企業詳細画面（company.profile）にリダイレクト
- **UI**:
  - ユーザー情報と企業プロフィール情報を1画面で入力
  - 2段階選択（都道府県→市区町村）の実装

#### 企業詳細画面
- **ルート**: `GET /company/profile`
- **ルート名**: `company.profile`
- **コンポーネント**: `resources/views/livewire/company/show.blade.php`
- **ミドルウェア**: `auth`, `role:company`
- **機能**: ログインユーザーの企業プロフィール表示
- **表示項目**: company_profilesテーブルの全項目
- **アクション**: 編集画面へのリンク

#### 企業編集画面
- **ルート**: `GET /company/edit`
- **ルート名**: `company.edit`
- **コンポーネント**: `resources/views/livewire/company/edit.blade.php`
- **ミドルウェア**: `auth`, `role:company`
- **機能**: ログインユーザーの企業プロフィール編集
- **入力項目**: 企業プロフィール項目のみ（location_id, address, representative, phone_number）
- **処理**:
  - バリデーション後、company_profilesテーブルを更新
  - 更新成功後、企業詳細画面（company.profile）にリダイレクト
- **UI**:
  - 既存データを初期表示
  - 2段階選択（都道府県→市区町村）の実装
- **注意**: 企業名（users.name）の変更は別途ユーザー情報編集機能で対応

#### 所在地の2段階選択仕様
- **都道府県選択**:
  - locationsテーブルから`city IS NULL`のデータを取得
  - `code`の昇順でソート
- **市区町村選択**:
  - 選択された都道府県に対応する市区町村を取得
  - `prefecture`が選択された都道府県と一致し、`city IS NOT NULL`のデータ
  - `code`の昇順でソート
- **連動動作**:
  - 都道府県を変更すると、市区町村の選択肢が更新される
  - 都道府県を変更すると、市区町村の選択はリセットされる
