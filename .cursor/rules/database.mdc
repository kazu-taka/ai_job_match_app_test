---
alwaysApply: true
---

# データベース設計

## データベース操作の原則
- Eloquent ORM使用必須
- 生のSQLクエリ使用禁止
- `DB::`ではなく`Model::query()`使用
- N+1問題への対策必須（先読み込み使用）
- リレーションシップメソッドに戻り値の型ヒント必須

## マイグレーション作成規則
- `sail artisan make:migration` 使用
- カラム変更時は以前の全属性を含める
- 適切なインデックス設定
- 外部キー制約の明示

## 実装済みテーブル

### users（認証システムで自動作成済み）
**目的**: ユーザーアカウント管理（企業・ワーカーの識別）

**カラム定義**:
- id: bigint unsigned, primary key
- name: string(255), 氏名または会社名
- email: string(255), unique, ログインに使用
- email_verified_at: timestamp, nullable
- password: string(255), ハッシュ化
- role: enum('company', 'worker'), ユーザー役割（デフォルト='worker'）
- two_factor_secret: text, nullable
- two_factor_recovery_codes: text, nullable
- two_factor_confirmed_at: timestamp, nullable
- remember_token: string(100), nullable
- created_at: timestamp
- updated_at: timestamp

**インデックス**:
- PRIMARY: id
- UNIQUE: email

**リレーション**:
- worker_profiles: 1対1
- company_profiles: 1対1

---

### worker_profilesテーブル

**目的**: ワーカー固有プロフィール情報

**カラム定義**:
- user_id: bigint unsigned, primary key, 外部キー（users.id）
- gender: enum('male', 'female', 'other'), 性別
- birthdate: date, 生年月日
- skills: text, nullable, スキル（例：英語、TOEIC700点、プログラミング（Laravel））
- experiences: text, nullable, 経験（例：接客 3年、プログラミング5年、スーパーのレジ1年）
- desired_jobs: string(255), nullable, 希望職種
- desired_location_id: bigint unsigned, nullable, 外部キー（locations.id）、希望勤務地
- created_at, updated_at: timestamps

**インデックス**:
- PRIMARY: user_id
- FOREIGN KEY: user_id (users.id) ON DELETE CASCADE
- FOREIGN KEY: desired_location_id (locations.id) ON DELETE RESTRICT

**リレーション**:
- users: 1対1（CASCADE削除）
- locations: 多対1（RESTRICT削除）

---

### company_profilesテーブル

**目的**: 企業固有プロフィール情報

**カラム定義**:
- user_id: bigint unsigned, primary key, 外部キー（users.id）
- location_id: bigint unsigned, 外部キー（locations.id）、所在地
- address: string(255), 所在地住所
- representative: string(255), 担当者名
- phone_number: string(255), 担当者連絡先
- created_at, updated_at: timestamps

**インデックス**:
- PRIMARY: user_id
- FOREIGN KEY: user_id (users.id) ON DELETE CASCADE
- FOREIGN KEY: location_id (locations.id) ON DELETE RESTRICT

**リレーション**:
- users: 1対1（CASCADE削除）
- locations: 多対1（RESTRICT削除）

---

### locationsテーブル

**目的**: 都道府県・市区町村マスタデータ

**カラム定義**:
- id: bigint unsigned, primary key
- prefecture: string(255), 都道府県名
- city: string(255), nullable, 市区町村名（都道府県データの場合はNULL）
- code: string(255), unique, 地域コード（JIS X 0402準拠）
- created_at, updated_at: timestamps

**インデックス**:
- PRIMARY: id
- UNIQUE: code

**リレーション**: なし

**備考**:
- cityがNULLのデータ: 都道府県データ（47件）
- cityが値ありのデータ: 市区町村データ（1747件）
- 登録件数: 1794件（都道府県47件 + 市区町村1747件）

---

### codesテーブル

**目的**: 雇用形態・勤務形態・業種のマスタデータ

**カラム定義**:
- id: bigint unsigned, primary key
- type: bigint, コード種類（type=0にコード種類の仕様を登録）
- type_id: bigint, コード種類ごとのID
- name: string(255), 表示名称
- description: text, nullable, 補足説明
- sort_order: integer, nullable, 表示順
- created_at, updated_at: timestamps

**インデックス**:
- PRIMARY: id

**リレーション**: なし

**コード種類一覧**:
- type=0: コード種類定義
- type=1: 雇用形態
- type=2: 勤務形態
- type=3: 業種

---

### job_postsテーブル

**目的**: 求人情報

**カラム定義**:
- id: bigint unsigned, primary key
- company_id: bigint unsigned, 外部キー（users.id）、求人投稿した企業ユーザー
- title: string(255), 求人タイトル
- description: text, 詳細内容
- employment_type_id: bigint, 雇用形態（codes.type=1のcodes.type_id）
- work_style_id: bigint, 勤務形態（codes.type=2のcodes.type_id）
- industry_id: bigint, 業種（codes.type=3のcodes.type_id）
- location_id: bigint unsigned, 外部キー（locations.id）、勤務地
- working_hours: string(255), 勤務時間
- salary: integer, 給与（時給、日給、月給）
- number_of_positions: integer, 募集人数
- posted_at: datetime, nullable, 投稿日時
- expires_at: datetime, nullable, 募集期限
- created_at, updated_at: timestamps

**インデックス**:
- PRIMARY: id
- FOREIGN KEY: company_id (users.id) ON DELETE CASCADE
- FOREIGN KEY: location_id (locations.id) ON DELETE RESTRICT

**リレーション**:
- users: 多対1（CASCADE削除）- 企業ユーザーが削除されたら求人も削除
- codes: 多対1（employment_type_id、work_style_id、industry_id）
- locations: 多対1（RESTRICT削除）

**備考**:
- employment_type_id、work_style_id、industry_idは、codesテーブルのtype_idを参照
- posted_atは登録時に自動的に現在日時を設定

---

### job_applicationsテーブル

**目的**: 応募状況の記録

**カラム定義**:
- id: bigint unsigned, primary key
- job_id: bigint unsigned, 外部キー（job_posts.id）、求人情報
- worker_id: bigint unsigned, 外部キー（users.id）、ワーカーのユーザーID
- motive: text, nullable, 志望動機
- status: enum('applied', 'accepted', 'rejected', 'declined'), ステータス（applied=応募、accepted=承認、rejected=不承認、declined=辞退）
- applied_at: datetime, 応募日時
- judged_at: datetime, nullable, 採用判定日時（承認または不承認時）
- declined_at: datetime, nullable, 辞退日時
- created_at, updated_at: timestamps

**インデックス**:
- PRIMARY: id
- UNIQUE: (job_id, worker_id) - 重複応募防止
- FOREIGN KEY: job_id (job_posts.id) ON DELETE RESTRICT
- FOREIGN KEY: worker_id (users.id) ON DELETE RESTRICT

**リレーション**:
- job_posts: 多対1（RESTRICT削除）
- users: 多対1（RESTRICT削除）

**備考**:
- (job_id, worker_id)に複合ユニーク制約を設定し、重複応募を防止
- statusのデフォルト値は'applied'

---

## シーディング

### usersテーブル

**企業ユーザー（5件）**:
- name="株式会社北海水産", email="hokkai@suisan.co.jp", password="password", role="company"
- name="東京テクノロジー", email="tokyo@tech-tokyo.jp", password="password", role="company"
- name="大阪商事株式会社", email="osaka@osaka-shoji.com", password="password", role="company"
- name="福岡フーズ", email="fukuoka@foods-fukuoka.jp", password="password", role="company"
- name="名古屋エンジニアリング", email="nagoya@nagoya-eng.co.jp", password="password", role="company"

**ワーカーユーザー（5件）**:
- name="佐藤 太郎", email="sato.taro@gmail.com", password="password", role="worker"
- name="田中 花子", email="tanaka.hanako@yahoo.co.jp", password="password", role="worker"
- name="鈴木 一郎", email="suzuki.ichiro@outlook.com", password="password", role="worker"
- name="高橋 美咲", email="takahashi.misaki@icloud.com", password="password", role="worker"
- name="渡辺 健太", email="watanabe.kenta@hotmail.com", password="password", role="worker"

**パスワードルール**: ハッシュ化して登録（Hash::make()使用）、email_verified_atは現在時刻

---

### worker_profilesテーブル

**ワーカープロフィール（5件）**:

| user_id | 性別 | 生年月日 | スキル | 経験 | 希望職種 | 希望勤務地コード |
|-|-|-|-|-|-|-|
| 6 | male | 1990-05-15 | 接客、英語（TOEIC750点）、Excel | 飲食店勤務 5年、ホテルフロント 3年 | 接客・サービス | 011002 |
| 7 | female | 1995-08-22 | プログラミング（PHP、JavaScript）、Laravel | Web開発 3年、フリーランス 2年 | エンジニア | 131016 |
| 8 | male | 1988-03-10 | 営業、プレゼンテーション、Excel | 営業職 8年、チームリーダー 2年 | 営業・企画 | 271004 |
| 9 | female | 1992-11-30 | デザイン（Photoshop、Illustrator）、UI/UX | グラフィックデザイン 4年 | デザイナー | 401005 |
| 10 | male | 1993-07-05 | 会計、簿記2級、Excel | 経理事務 5年 | 事務・経理 | 231002 |

**備考**:
- user_idは6〜10（ワーカーユーザー）
- 希望勤務地コードはlocationsテーブルの団体コード
  - 011002: 札幌市
  - 131016: 東京都千代田区
  - 271004: 大阪市
  - 401005: 福岡市
  - 231002: 名古屋市

---

### company_profilesテーブル

**企業プロフィール（5件）**:

| user_id | 所在地コード | 所在地住所 | 担当者名 | 担当者連絡先 |
|-|-|-|-|-|
| 1 | 011002 | 北海道札幌市中央区北1条西5丁目 | 山田　太郎 | 011-123-4567 |
| 2 | 131016 | 東京都千代田区丸の内1-1-1 | 田中　次郎 | 03-1234-5678 |
| 3 | 271004 | 大阪府大阪市北区梅田1-1-1 | 鈴木　三郎 | 06-1234-5678 |
| 4 | 401005 | 福岡県福岡市博多区博多駅前1-1-1 | 高橋　四郎 | 092-123-4567 |
| 5 | 231002 | 愛知県名古屋市中区栄1-1-1 | 伊藤　五郎 | 052-123-4567 |

**備考**:
- user_idは1〜5（企業ユーザー）
- user_id対応の企業名はusersテーブルのnameを参照
- 所在地コードはlocationsテーブルの団体コード

---

### locationsテーブル

**データソース**: files/市区町村コード.csv

**カラム対応**:
- CSVの「団体コード」 → locationsテーブルの「code」
- CSVの「都道府県名（漢字）」 → locationsテーブルの「prefecture」
- CSVの「市区町村名（漢字）」 → locationsテーブルの「city」（空白の場合はNULL）

**処理要件**:
- 進捗表示: 500件ごと
- パフォーマンス最適化: バッチ挿入
- 登録件数: 1794件

---

### codesテーブル

**登録データ（15件）**:

コード種類定義（type=0）:
- type=0, type_id=1, name="雇用形態", sort_order=1
- type=0, type_id=2, name="勤務形態", sort_order=2
- type=0, type_id=3, name="業種", sort_order=3

雇用形態（type=1）:
- type=1, type_id=1, name="正社員", sort_order=1
- type=1, type_id=2, name="契約社員", sort_order=2
- type=1, type_id=3, name="パート", sort_order=3
- type=1, type_id=4, name="アルバイト", sort_order=4

勤務形態（type=2）:
- type=2, type_id=1, name="出社", sort_order=1
- type=2, type_id=2, name="週3日", sort_order=2
- type=2, type_id=3, name="時短", sort_order=3
- type=2, type_id=4, name="リモート", sort_order=4

業種（type=3）:
- type=3, type_id=1, name="飲食", sort_order=1
- type=3, type_id=2, name="製造", sort_order=2
- type=3, type_id=3, name="システム開発", sort_order=3
- type=3, type_id=4, name="教育", sort_order=

---

### job_postsテーブル

**登録データ（43件）**:

株式会社北海水産（company_id=1）- 8件:
- title="水産加工スタッフ募集", description="北海道の新鮮な魚介類を扱う水産加工のお仕事です。未経験者歓迎！丁寧に指導します。", employment_type_id=3, work_style_id=1, industry_id=2, location_code="011002", working_hours="9:00-15:00", salary=1100, number_of_positions=3, expires_at="1ヶ月後"
- title="飲食店ホールスタッフ", description="直営飲食店でのホール接客業務。週3日からOK。学生・主婦歓迎！", employment_type_id=4, work_style_id=3, industry_id=1, location_code="011002", working_hours="17:00-22:00", salary=1200, number_of_positions=2
- title="鮮魚販売スタッフ", description="直営店舗での鮮魚販売。接客・品出し・在庫管理など。未経験OK。", employment_type_id=3, work_style_id=1, industry_id=1, location_code="012025", working_hours="6:00-14:00", salary=1150, number_of_positions=2
- title="配送ドライバー", description="水産物の配送業務。要普通免許。早朝勤務手当あり。", employment_type_id=2, work_style_id=1, industry_id=2, location_code="012025", working_hours="5:00-13:00", salary=280000, number_of_positions=2, expires_at="2ヶ月後"
- title="経理事務", description="経理業務全般。仕訳入力、請求書発行など。簿記資格歓迎。", employment_type_id=2, work_style_id=1, industry_id=2, location_code="011002", working_hours="9:00-17:00", salary=240000, number_of_positions=1
- title="品質管理スタッフ", description="水産加工品の品質チェック。衛生管理経験者優遇。", employment_type_id=1, work_style_id=1, industry_id=2, location_code="012033", working_hours="8:00-17:00", salary=320000, number_of_positions=1
- title="営業スタッフ", description="飲食店向け営業。既存顧客フォローメイン。要普通免許。", employment_type_id=1, work_style_id=1, industry_id=2, location_code="011002", working_hours="9:00-18:00", salary=350000, number_of_positions=2
- title="調理補助スタッフ", description="直営食堂での調理補助。野菜カット、盛り付けなど。未経験OK。", employment_type_id=4, work_style_id=3, industry_id=1, location_code="012025", working_hours="10:00-16:00", salary=1050, number_of_positions=3

東京テクノロジー株式会社（company_id=2）- 10件:
- title="Webアプリケーションエンジニア", description="PHP/Laravelを使用した自社サービス開発。フルリモート可能。技術力を高めたい方歓迎！", employment_type_id=1, work_style_id=2, industry_id=3, location_code="131016", working_hours="10:00-19:00", salary=500000, number_of_positions=2, expires_at="3ヶ月後"
- title="システム運用保守担当", description="自社システムの運用・保守業務。障害対応やユーザーサポートを担当します。", employment_type_id=2, work_style_id=1, industry_id=3, location_code="131032", working_hours="9:00-18:00", salary=350000, number_of_positions=1
- title="プログラミング講師", description="初心者向けプログラミングスクールの講師。PHPやJavaScriptを教えます。時短勤務可。", employment_type_id=3, work_style_id=4, industry_id=4, location_code="131041", working_hours="10:00-15:00", salary=2000, number_of_positions=2
- title="フロントエンドエンジニア", description="React/Vue.jsを使用したUI開発。モダンな技術スタックで開発できます。", employment_type_id=1, work_style_id=2, industry_id=3, location_code="131016", working_hours="10:00-19:00", salary=480000, number_of_positions=2
- title="インフラエンジニア", description="AWS/GCPを使用したクラウドインフラ構築・運用。SRE業務にも挑戦できます。", employment_type_id=1, work_style_id=2, industry_id=3, location_code="131032", working_hours="10:00-19:00", salary=550000, number_of_positions=1
- title="データサイエンティスト", description="Python/機械学習を使用したデータ分析。統計学の知識を活かせます。", employment_type_id=1, work_style_id=2, industry_id=3, location_code="131016", working_hours="10:00-19:00", salary=600000, number_of_positions=1, expires_at="2ヶ月後"
- title="QAエンジニア", description="自社サービスの品質保証。テスト設計・実行・自動化を担当。", employment_type_id=2, work_style_id=1, industry_id=3, location_code="131130", working_hours="9:00-18:00", salary=380000, number_of_positions=1
- title="Webデザイナー", description="自社サービスのUI/UXデザイン。Figma使用経験者優遇。", employment_type_id=2, work_style_id=2, industry_id=3, location_code="131041", working_hours="10:00-19:00", salary=400000, number_of_positions=1
- title="ITサポート事務", description="社内システムのヘルプデスク対応。ITに興味がある方歓迎。", employment_type_id=3, work_style_id=1, industry_id=3, location_code="131016", working_hours="9:00-17:00", salary=1500, number_of_positions=2
- title="プロジェクトマネージャー", description="開発プロジェクトの管理。上流工程からリリースまで一貫して担当。", employment_type_id=1, work_style_id=1, industry_id=3, location_code="131032", working_hours="10:00-19:00", salary=700000, number_of_positions=1

大阪商事株式会社（company_id=3）- 8件:
- title="営業事務スタッフ", description="商社での営業事務業務。伝票処理や電話対応など。Excel使用経験者優遇。", employment_type_id=2, work_style_id=1, industry_id=2, location_code="271004", working_hours="9:00-17:00", salary=250000, number_of_positions=1, expires_at="1ヶ月後"
- title="法人営業", description="既存取引先への営業活動。提案営業経験者優遇。", employment_type_id=1, work_style_id=1, industry_id=2, location_code="271004", working_hours="9:00-18:00", salary=380000, number_of_positions=2
- title="貿易事務", description="輸出入書類作成、通関手続き。英語スキル活かせます。", employment_type_id=2, work_style_id=1, industry_id=2, location_code="271403", working_hours="9:00-17:00", salary=280000, number_of_positions=1
- title="倉庫管理スタッフ", description="商品の入出庫管理、在庫管理。フォークリフト免許歓迎。", employment_type_id=3, work_style_id=1, industry_id=2, location_code="272035", working_hours="8:00-17:00", salary=1200, number_of_positions=2, expires_at="3ヶ月後"
- title="総務人事", description="総務・人事業務全般。給与計算、採用業務など。", employment_type_id=2, work_style_id=1, industry_id=2, location_code="271004", working_hours="9:00-17:00", salary=270000, number_of_positions=1
- title="商品企画", description="新商品の企画・開発。マーケティング経験者優遇。", employment_type_id=1, work_style_id=1, industry_id=2, location_code="271004", working_hours="9:00-18:00", salary=420000, number_of_positions=1
- title="経理担当", description="月次決算、年次決算。簿記2級以上必須。", employment_type_id=1, work_style_id=1, industry_id=2, location_code="271403", working_hours="9:00-17:00", salary=360000, number_of_positions=1
- title="一般事務", description="データ入力、電話対応、来客対応など。未経験OK。", employment_type_id=3, work_style_id=1, industry_id=2, location_code="271004", working_hours="9:00-17:00", salary=1100, number_of_positions=2

株式会社福岡フーズ（company_id=4）- 8件:
- title="カフェスタッフ募集", description="直営カフェでの接客・調理補助。朝の時間帯で働けます。未経験OK！", employment_type_id=4, work_style_id=1, industry_id=1, location_code="401307", working_hours="7:00-14:00", salary=1000, number_of_positions=3, expires_at="1ヶ月後"
- title="食品製造スタッフ", description="惣菜・弁当の製造スタッフ。週3日からOK。主婦の方活躍中！", employment_type_id=3, work_style_id=3, industry_id=2, location_code="402192", working_hours="8:00-16:00", salary=1150, number_of_positions=2
- title="店舗マネージャー", description="直営カフェの店舗運営管理。スタッフ育成、売上管理など。", employment_type_id=1, work_style_id=1, industry_id=1, location_code="401307", working_hours="8:00-17:00", salary=320000, number_of_positions=1
- title="パティシエ", description="カフェでのケーキ・デザート製造。製菓専門学校卒業者優遇。", employment_type_id=2, work_style_id=1, industry_id=1, location_code="401005", working_hours="6:00-15:00", salary=280000, number_of_positions=1
- title="商品開発", description="新メニュー・新商品の開発。食品開発経験者歓迎。", employment_type_id=1, work_style_id=1, industry_id=2, location_code="401307", working_hours="9:00-18:00", salary=380000, number_of_positions=1
- title="配送ドライバー", description="惣菜・弁当の配送。要普通免許。短時間勤務OK。", employment_type_id=3, work_style_id=3, industry_id=2, location_code="402192", working_hours="10:00-15:00", salary=1200, number_of_positions=2
- title="品質管理", description="食品の衛生管理、品質チェック。食品衛生責任者資格歓迎。", employment_type_id=2, work_style_id=1, industry_id=2, location_code="401005", working_hours="8:00-17:00", salary=270000, number_of_positions=1
- title="営業スタッフ", description="法人向け弁当販売営業。既存顧客メイン。要普通免許。", employment_type_id=1, work_style_id=1, industry_id=1, location_code="401307", working_hours="9:00-18:00", salary=340000, number_of_positions=1

名古屋エンジニアリング株式会社（company_id=5）- 9件:
- title="社内システム開発エンジニア", description="自社業務システムの開発・改善。Java/Pythonなど。上流工程にも携われます。", employment_type_id=1, work_style_id=1, industry_id=3, location_code="231002", working_hours="9:00-18:00", salary=450000, number_of_positions=2, expires_at="3ヶ月後"
- title="ITサポートスタッフ", description="社内ヘルプデスク業務。PCトラブル対応やシステム操作サポート。リモート勤務可。", employment_type_id=2, work_style_id=2, industry_id=3, location_code="232076", working_hours="10:00-19:00", salary=300000, number_of_positions=1
- title="システム開発インターン", description="実務経験を積めるインターンシップ。プログラミング学習中の学生歓迎！", employment_type_id=4, work_style_id=3, industry_id=3, location_code="231002", working_hours="10:00-16:00", salary=1500, number_of_positions=2, expires_at="2ヶ月後"
- title="組込みエンジニア", description="産業機器の組込みシステム開発。C/C++経験者優遇。", employment_type_id=1, work_style_id=1, industry_id=3, location_code="232114", working_hours="9:00-18:00", salary=480000, number_of_positions=1
- title="ネットワークエンジニア", description="社内ネットワーク構築・運用。CCNA資格歓迎。", employment_type_id=2, work_style_id=1, industry_id=3, location_code="231002", working_hours="9:00-18:00", salary=380000, number_of_positions=1
- title="セールスエンジニア", description="技術営業。顧客への技術提案、導入支援を担当。", employment_type_id=1, work_style_id=1, industry_id=3, location_code="232076", working_hours="9:00-18:00", salary=420000, number_of_positions=1
- title="システムテスター", description="システムの動作検証、テスト実行。未経験可、研修あり。", employment_type_id=3, work_style_id=1, industry_id=3, location_code="231002", working_hours="9:00-17:00", salary=1400, number_of_positions=2
- title="技術サポート", description="顧客向け技術サポート。電話・メール対応。リモート可。", employment_type_id=2, work_style_id=2, industry_id=3, location_code="232114", working_hours="10:00-19:00", salary=320000, number_of_positions=1
- title="データベースエンジニア", description="データベース設計・構築・運用。SQL経験者優遇。", employment_type_id=1, work_style_id=1, industry_id=3, location_code="231002", working_hours="9:00-18:00", salary=500000, number_of_positions=1

**備考**:
- company_idは1〜5（企業ユーザー）
- employment_type_id: 1=正社員、2=契約社員、3=パート、4=アルバイト
- work_style_id: 1=出社、2=リモート、3=週3日、4=時短
- industry_id: 1=飲食、2=製造、3=システム開発、4=教育
- location_codeはlocationsテーブルのcode（location_idに変換して登録）
  - 011002: 札幌市、012025: 函館市、012033: 小樽市
  - 131016: 千代田区、131032: 港区、131041: 新宿区、131130: 渋谷区
  - 271004: 大阪市、271403: 堺市、272035: 豊中市
  - 401005: 北九州市、401307: 福岡市、402192: 大野城市
  - 231002: 名古屋市、232076: 豊田市、232114: 刈谷市
- salaryは雇用形態により単位が異なる
  - 正社員・契約社員: 月給（円）
  - パート・アルバイト: 時給（円）
- posted_atは登録時に現在日時を自動設定
- expires_atは募集期限
  - 期限あり: 登録日から1ヶ月後、2ヶ月後、3ヶ月後（9件）
  - 期限なし: NULL（34件）
